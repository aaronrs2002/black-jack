<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS-->
    <link href="css/bootstrap.min.css" rel="stylesheet" id="themedStyle">


    <link href="css/style.css" rel="stylesheet">
    <title>JavaScript Card Games</title>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="btn-group form-control" role="group">
                <button type="button" class="btn btn-primary dealAmt" alt="1" onClick="deal(Number(1))">$1</button>
                <button type="button" class="btn btn-primary dealAmt" alt="5" onClick="deal(Number(5))">$5</button>
                <button type="button" class="btn btn-primary dealAmt" alt="10" onClick="deal(Number(10))">$10</button>
                <button type="button" class="btn btn-primary dealAmt" alt="25" onClick="deal(Number(25))">$25</button>
                <button type="button" class="btn btn-primary dealAmt" alt="50" onClick="deal(Number(50))">$50</button>
                <button type="button" class="btn btn-primary dealAmt" alt="100"
                    onClick="deal(Number(100))">$100</button>
            </div>
            <div class="col-md-12" id="dealerCards">
            </div>
            <div class="col-md-12">
                <div class="alert alert-secondary hide" id="dealerTotal" role="alert"></div>
            </div>
            <div class="col-md-12" id="playerCards">
            </div>
            <!--start split-->
            <div class="col-md-6" id="split0"></div>
            <div class="col-md-6" id="split1"></div>
            <!--end split-->
            <div class="col-md-12">
                <div class="alert alert-secondary hide" id="playerTotal" role="alert"></div>
            </div>
            <div class="col-md-12 hide" id="playBts">
                <div class="btn-group form-control" role="group">
                    <button type="button" class="btn btn-primary" alt="hit" onClick="hit()">HIT</button>
                    <button type="button" class="btn btn-primary" alt="stay" onClick="stay()">STAY</button>
                    <button type="button" class="btn btn-primary" alt="split" onClick="split()">SPLIT</button>
                </div>
            </div>

            <div class="col-md-12">
                <div class="alert hide" id="status" role="alert">
                    <h1 id="message"></h1>
                </div>

                <div class="alert alert-dark" role="alert">
                    <ul class="list-unstyled">
                        <li>
                            <h2>Player Balance: $<span id="playerMoney">500</span></h2>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-md-12">
                <select class="form-control" onChange="changeTheme()" id="themes"></select>
            </div>
        </div>
    </div>
</body>
<script src="js/cards.js"></script>
<script src="js/themesList.js"></script>
<script>
    //START THEMES
    if (localStorage.getItem("theme")) {
        document.getElementById("themedStyle").setAttribute("href", localStorage.getItem("theme"));
    }
    let themeOptions = "<option value='css/bootstrap.min.css'>Select Theme</option>";
    for (let i = 0; i < themesList.length; i++) {
        themeOptions = themeOptions + "<option value='" + themesList[i] + "'>" + themesList[i].substring(25, themesList[i].lastIndexOf("/")) + "</option>";
    }
    document.getElementById("themes").innerHTML = themeOptions;
    function changeTheme() {
        let whichTheme = document.getElementById("themes").value;
        document.getElementById("themedStyle").setAttribute("href", whichTheme);
        localStorage.setItem("theme", whichTheme);
    }

    //END THEMES

    let tempCards = [];
    localStorage.setItem("cards", JSON.stringify(cards));
    const originalCards = cards;
    //SPIT CARDS
    let splitActive = false;
    let playerTotal0 = 0;
    let playerTotal1 = 0;
    /*START DEALER VARIABLES*/
    let dealerCards = [];
    let dealerHTML = "";
    let dealerTotal = 0;
    /*START PLAYER VARIABLES*/
    let playerCards = [];
    let playerHTML = "";
    let playerTotal = 0;
    /*DOES NOT RESET AT DEAL*/
    let playerMoney = 500;
    let bet = 0;
    /*END DOES NOT RESET AT DEAL*/
    //document.getElementById("playerMoney").innerHTML = playerMoney;

    function showAlert(status, message, type) {
        document.getElementById("playBts").classList.add("hide");
        if (message === "default") {
            document.getElementById("status").classList.add("hide");
            document.getElementById("status").classList.remove("alert-danger");
            document.getElementById("status").classList.remove("alert-success");
        } else {
            document.getElementById("message").innerHTML = message;
            document.getElementById("status").classList.remove("hide");
            document.getElementById("status").classList.add(type);
        }
        if (status !== "split") {
            if (status === "win") {
                playerMoney = (playerMoney + bet);
            }
            if (status === "black-jack") {
                playerMoney = (playerMoney + (bet * 1.5));
            }
            if (status === "lose") {
                playerMoney = (playerMoney - bet);
            }
            document.getElementById("playerMoney").innerHTML = playerMoney;
        }
        document.querySelector("button[alt='split']").disabled = false;
        return false;
    }

    function deal(playerBet) {
        document.querySelector("#split0").innerHTML = "";
        document.querySelector("#split1").innerHTML = "";
        if (document.querySelectorAll(".dealAmt")) {
            [].forEach.call(document.querySelectorAll(".dealAmt"), function (e) {
                e.classList.remove("active");
            })
        }
        cards = JSON.parse(localStorage.getItem("cards"));
        document.querySelector(".dealAmt[alt='" + playerBet + "']").classList.add("active");
        bet = playerBet;
        /*START RESET*/
        tempCards = [];
        /*START DEALER VARIABLES*/
        dealerCards = [];
        dealerHTML = "";
        dealerTotal = 0;
        /*START PLAYER VARIABLES*/
        playerCards = [];
        playerHTML = "";
        playerTotal = 0;
        showAlert("default", "default", "hide");
        document.getElementById("playerTotal").innerHTML = playerTotal;
        document.getElementById("dealerTotal").innerHTML = dealerTotal;
        document.getElementById("dealerCards").innerHTML = "";
        document.getElementById("playerCards").innerHTML = "";
        document.getElementById("playerTotal").classList.add("hide");
        document.getElementById("dealerTotal").classList.add("hide");
        /*END RESET*/

        let randNumsArr = [];
        for (let i = 0; i < cards.length; i++) {
            while (randNumsArr.length < 6) {/*we burn the first card*/
                let newNum = cards[Math.floor(Math.random() * cards.length)];
                if (randNumsArr.indexOf(newNum) === -1) {
                    randNumsArr.push(newNum);
                }
            }
        }

        dealerCards = [randNumsArr[1], randNumsArr[3]];
        playerCards = [randNumsArr[2], randNumsArr[4]];

        for (let i = 0; i < cards.length; i++) {
            if (randNumsArr.indexOf(cards[i]) === -1) {
                tempCards.push(cards[i]);
            }
        }
        cards = tempCards;

        for (let i = 0; i < 2; i++) {
            let hiddenCard = "";
            if (i === 0) {
                hiddenCard = "hiddenDealerCard"
            }
            dealerHTML = dealerHTML + "<div data-dealer='" + i + "' class='card " + dealerCards[i].title + " " + hiddenCard + "'></div>";
            dealerTotal = dealerCards[1].value;
            document.getElementById("dealerTotal").innerHTML = dealerTotal;
        }
        for (let i = 0; i < 2; i++) {
            playerHTML = playerHTML + "<div data-player='" + i + "' class='card " + playerCards[i].title + "'></div>";
        }
        playerTotal = (Number(playerCards[0].value) + Number(playerCards[1].value));
        if (playerTotal === 22) {
            playerTotal = 12
        }
        if (playerTotal === 21) {
            document.getElementById("playBts").classList.add("hide");
            showAlert("black-jack", "BLACK JACK! ", "alert-success");

        } else {
            document.getElementById("playBts").classList.remove("hide");
        }

        document.getElementById("playerTotal").innerHTML = playerTotal;
        document.getElementById("dealerCards").innerHTML = dealerHTML;
        document.getElementById("playerCards").innerHTML = playerHTML;
        document.getElementById("playerTotal").classList.remove("hide");
        document.getElementById("dealerTotal").classList.remove("hide");
    }

    function stay() {    //START STAY()
        let tempMessage = "DEFAULT";
        showAlert("default", "DEFAULT", "hide");
        dealerHTML = "";
        for (let i = 0; i < dealerCards.length; i++) {
            dealerHTML = dealerHTML + "<div data-dealer='" + i + "' class='card " + dealerCards[i].title + "'></div>";
        }
        document.getElementById("dealerCards").innerHTML = dealerHTML;
        document.getElementById("dealerTotal").innerHTML = dealerTotal;
        document.querySelector("#playBts").classList.add("hide");
        dealerTotal = 0;
        for (let i = 0; i < dealerCards.length; i++) {
            dealerTotal = (Number(dealerTotal) + Number(dealerCards[i].value));
        }
        document.querySelector("#dealerTotal").innerHTML = dealerTotal;
        function addcard() {
            tempCards = [];
            let randomNum = Math.floor(Math.random() * cards.length);
            dealerCards.push(cards[randomNum]);
            dealerHTML = dealerHTML + "<div data-dealer='" + dealerCards.length + "' class='card " + cards[randomNum].title + "'></div>";
            document.getElementById("dealerCards").innerHTML = dealerHTML;
            dealerTotal = (Number(dealerTotal) + Number(cards[randomNum].value));
            document.getElementById("dealerTotal").innerHTML = dealerTotal;
            for (let i = 0; i < cards.length; i++) {
                if (dealerCards.indexOf(cards[i]) === -1 && playerCards.indexOf(cards[i]) === -1) {
                    tempCards.push(cards[i]);
                }
            }
            cards = tempCards;
        }

        if (splitActive === true) {
            let splitArr = [Number(playerTotal0), Number(playerTotal1)];
            while (dealerTotal <= 16 && dealerTotal <= 21) {
                addcard();
            }
            let splitMessage = "";
            if (dealerTotal > 21) {
                showAlert("split", "YOU WON. DEALER BUSTED!", "alert-success");
                playerMoney = (playerMoney + bet + bet);
            } else {
                for (let i = 0; i < splitArr.length; i++) {
                    if (dealerTotal < splitArr[i]) {
                        playerMoney = (playerMoney += bet);
                        splitMessage = splitMessage + "YOU WON HAND " + (i + 1) + ". ";
                    }
                    if (dealerTotal > splitArr[i]) {
                        playerMoney = (playerMoney -= bet);
                        splitMessage = splitMessage + "YOU LOST HAND " + (i + 1) + ". ";
                    }
                    if (dealerTotal === splitArr[i]) {
                        splitMessage = splitMessage + "YOU PUSHED HAND " + (i + 1) + ". ";
                    }
                    if (splitArr[i] === 21) {
                        playerMoney = (playerMoney += (bet * .5))
                    }
                }
                showAlert("split", splitMessage, "alert-primary");
                document.getElementById("playerMoney").innerHTML = playerMoney;
            }
        } else {
            while (dealerTotal <= 16 && dealerTotal <= 21) {
                addcard();
            }

            let aces = [];
            if (dealerTotal > 21) {
                for (let i = 0; i < dealerCards.length; i++) {
                    if (dealerCards[i].title.indexOf("ace-") !== -1) {
                        aces.push(10);
                    }
                }
                if (dealerTotal > 21) {
                    console.log("aces.length: " + aces.length);
                    for (let j = 0; j < aces.length; j++) {
                        while (dealerTotal > 21 && aces[j] === 10) {
                            dealerTotal = (dealerTotal -= 10);
                            aces[j] = 0;
                        }
                    }
                    document.getElementById("dealerTotal").innerHTML = dealerTotal;
                    if (dealerTotal > 21) {
                        document.getElementById("dealerTotal").innerHTML = dealerTotal;
                        showAlert("win", "DEALER BUSTED. YOU WON!", "alert-success");
                    }
                }
                // showAlert("win", "DEALER BUSTED. YOU WON!", "alert-success");
            }
            if (dealerTotal <= 21 && dealerTotal > playerTotal) {
                showAlert("lose", "DEALER WON!", "alert-danger");
            }
            if (dealerTotal <= 21 && dealerTotal < playerTotal) {
                showAlert("win", "YOU WON!", "alert-success");
            }
            if (dealerTotal <= 21 && dealerTotal === playerTotal) {
                showAlert("default", "PUSH!", "alert-info");
            }
        }//end if/else
        splitActive = false;
    }

    function hit() {
        document.querySelector("button[alt='split']").disabled = true;
        let aces = [];
        tempCards = [];
        let randomNum = Math.floor(Math.random() * cards.length);
        playerCards.push(cards[randomNum]);
        playerHTML = playerHTML + "<div data-player='" + playerCards.length + "' class='card " + cards[randomNum].title + "'></div>";
        if (splitActive === false) {
            document.getElementById("playerCards").innerHTML = playerHTML;
            playerTotal = (Number(playerTotal) + Number(cards[randomNum].value));
            document.getElementById("playerTotal").innerHTML = playerTotal;
            for (let i = 0; i < cards.length; i++) {
                if (dealerCards.indexOf(cards[i]) === -1 && playerCards.indexOf(cards[i]) === -1) {
                    tempCards.push(cards[i]);
                }
            }
            cards = tempCards;
            for (let i = 0; i < playerCards.length; i++) {
                if (playerCards[i].title.indexOf("ace-") !== -1) {
                    aces.push(10);
                }
            }
            if (playerTotal > 21) {
                console.log("aces.length: " + aces.length);
                if (aces.length > 0) {
                    for (let j = 0; j < aces.length; j++) {
                        while (playerTotal > 21 && aces[j] === 10) {
                            playerTotal = (playerTotal -= 10);
                            console.log("playerTotal: " + playerTotal);
                            aces[j] = 0;
                        }
                    } document.getElementById("playerTotal").innerHTML = playerTotal;
                } else {

                    document.getElementById("playerTotal").innerHTML = playerTotal;
                    showAlert("lose", "YOU BUSTED. DEALER WON!", "alert-danger");
                }



            }
        } else {
            let preHTML0 = document.getElementById("split0").innerHTML;
            document.getElementById("split0").innerHTML = preHTML0 + "<div data-player='1' class='card " + cards[randomNum].title + "'></div>";
            playerTotal0 = playerCards[0].value + Number(cards[randomNum].value);
            let preHTML1 = document.getElementById("split1").innerHTML;
            document.getElementById("split1").innerHTML = preHTML1 + "<div data-player='1' class='card " + cards[randomNum].title + "'></div>";
            playerTotal1 = playerCards[1].value + Number(cards[randomNum].value);
            document.getElementById("playerTotal").innerHTML = playerTotal0 + " - " + playerTotal1;
            stay();
        }
    }

    function split() {
        splitActive = true;
        document.getElementById("playerCards").innerHTML = "";
        document.getElementById("split0").innerHTML = "<div data-player='0' class='card " + playerCards[0].title + "'></div>";
        document.getElementById("split1").innerHTML = "<div data-player='0' class='card " + playerCards[1].title + "'></div>";
        hit();
    }
</script>

</html>
