<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="css/style.css" rel="stylesheet">
    <title>JavaScript Card Games</title>
</head>

<body>
    <div class="container">
        <div class="row">
            <button class="btn btn-block btn-secondary" id="dealBt" onClick="deal()">DEAL</button>
            <div class="col-md-12" id="dealerCards">
            </div>
            <div class="col-md-12">
                <div class="alert alert-secondary hide" id="dealerTotal" role="alert"></div>
            </div>
            <div class="col-md-12" id="playerCards">
            </div>
            <div class="col-md-12">
                <div class="alert alert-secondary hide" id="playerTotal" role="alert"></div>
            </div>
            <div class="col-md-12 hide" id="playBts">
                <div class="btn-group form-control" role="group">
                    <button type="button" class="btn btn-primary" alt="hit" onClick="hit()">HIT</button>
                    <button type="button" class="btn btn-primary" alt="stay" onClick="stay()">STAY</button>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <div class="alert hide" id="status" role="alert">
                <h1 id="message"></h1>
            </div>
        </div>
    </div>
</body>
<script src="js/cards.js"></script>
<script>
    let tempCards = [];
    /*START DEALER VARIABLES*/
    let dealerCards = [];
    let dealerHTML = "";
    let dealerTotal = 0;
    /*START PLAYER VARIABLES*/
    let playerCards = [];
    let playerHTML = "";
    let playerTotal = 0;

    function showAlert(message, type) {
        if (message === "default") {
            document.getElementById("status").classList.add("hide");
            document.getElementById("status").classList.remove("alert-danger");
            document.getElementById("status").classList.remove("alert-success");
        } else {
            document.getElementById("message").innerHTML = message;
            document.getElementById("status").classList.remove("hide");
            document.getElementById("status").classList.add(type);
        }
        return false;
    }

    function deal() {
        /*START RESET*/
        tempCards = [];
        /*START DEALER VARIABLES*/
        dealerCards = [];
        dealerHTML = "";
        dealerTotal = 0;
        /*START PLAYER VARIABLES*/
        playerCards = [];
        playerHTML = "";
        playerTotal = 0;
        showAlert("default", "hide");
        document.getElementById("playerTotal").innerHTML = playerTotal;
        document.getElementById("dealerTotal").innerHTML = dealerTotal;
        document.getElementById("dealerCards").innerHTML = "";
        document.getElementById("playerCards").innerHTML = "";
        document.getElementById("playBts").classList.add("hide");
        document.getElementById("playerTotal").classList.add("hide");
        document.getElementById("dealerTotal").classList.add("hide");

        /*END RESET*/


        for (let i = 0; i < 5; i++) {
            if (i === 0 || i === 2) {
                let randomNum = cards[Math.floor(Math.random() * cards.length)];
                dealerCards.push(randomNum);
            }
            if (i === 1 || i === 3) {
                let randomNum = cards[Math.floor(Math.random() * cards.length)];
                playerCards.push(randomNum);
            }
        }
        for (let i = 0; i < cards.length; i++) {
            if (dealerCards.indexOf(cards[i]) === -1 && playerCards.indexOf(cards[i]) === -1) {
                tempCards.push(cards[i]);
            }
        }
        cards = tempCards;
        for (let i = 0; i < 2; i++) {
            let hiddenCard = "";
            if (i === 0) {
                hiddenCard = "hiddenDealerCard"
            }
            dealerHTML = dealerHTML + "<div data-dealer='" + i + "' class='card " + dealerCards[i].title + " " + hiddenCard + "'></div>";
            dealerTotal = dealerCards[1].value;
            document.getElementById("dealerTotal").innerHTML = dealerTotal;
        }
        for (let i = 0; i < 2; i++) {
            playerHTML = playerHTML + "<div data-player='" + i + "' class='card " + playerCards[i].title + "'></div>";
        }
        playerTotal = (Number(playerCards[0].value) + Number(playerCards[1].value));
        document.getElementById("playerTotal").innerHTML = playerTotal;
        document.getElementById("dealerCards").innerHTML = dealerHTML;
        document.getElementById("playerCards").innerHTML = playerHTML;
        document.getElementById("playBts").classList.remove("hide");
        document.getElementById("playerTotal").classList.remove("hide");
        document.getElementById("dealerTotal").classList.remove("hide");

    }

    function hit() {
        let aces = [];
        tempCards = [];
        let randomNum = Math.floor(Math.random() * cards.length);
        playerCards.push(cards[randomNum]);
        playerHTML = playerHTML + "<div data-player='" + playerCards.length + "' class='card " + cards[randomNum].title + "'></div>";
        document.getElementById("playerCards").innerHTML = playerHTML;
        playerTotal = (Number(playerTotal) + Number(cards[randomNum].value));
        document.getElementById("playerTotal").innerHTML = playerTotal;
        for (let i = 0; i < cards.length; i++) {
            if (dealerCards.indexOf(cards[i]) === -1 && playerCards.indexOf(cards[i]) === -1) {
                tempCards.push(cards[i]);
            }
        }
        cards = tempCards;

        for (let i = 0; i < playerCards.length; i++) {
            if (playerCards[i].title.indexOf("ace-") !== -1) {
                aces.push(playerCards[i].title);
            }
        }


        if (playerTotal > 21) {

            if (aces.length > 0) {
                playerTotal = (playerTotal - (10 * aces.length));
                console.log("How many Aces? " + aces.length);
            }
            document.getElementById("playerTotal").innerHTML = playerTotal;

            if (playerTotal > 21) {

                document.getElementById("playerTotal").innerHTML = playerTotal;
                showAlert("YOU BUSTED. DEALER WON!", "alert-danger");
                setTimeout(() => {
                    // window.location.reload();
                    deal();

                }, 2000);
            }


        }
    }

    function stay() {
        let tempMessage = "DEFAULT";
        showAlert("DEFAULT", "hide");
        dealerHTML = "";
        for (let i = 0; i < dealerCards.length; i++) {
            dealerHTML = dealerHTML + "<div data-dealer='" + i + "' class='card " + dealerCards[i].title + "'></div>";
        }
        document.getElementById("dealerCards").innerHTML = dealerHTML;
        document.getElementById("dealerTotal").innerHTML = dealerTotal;
        document.querySelector("#playBts").classList.add("hide");
        dealerTotal = 0;
        for (let i = 0; i < dealerCards.length; i++) {
            dealerTotal = (Number(dealerTotal) + Number(dealerCards[i].value));
        }
        document.querySelector("#dealerTotal").innerHTML = dealerTotal;

        function addcard() {
            tempCards = [];
            let randomNum = Math.floor(Math.random() * cards.length);
            dealerCards.push(cards[randomNum]);
            dealerHTML = dealerHTML + "<div data-dealer='" + dealerCards.length + "' class='card " + cards[randomNum].title + "'></div>";
            document.getElementById("dealerCards").innerHTML = dealerHTML;
            dealerTotal = (Number(dealerTotal) + Number(cards[randomNum].value));
            document.getElementById("dealerTotal").innerHTML = dealerTotal;
            for (let i = 0; i < cards.length; i++) {
                if (dealerCards.indexOf(cards[i]) === -1 && playerCards.indexOf(cards[i]) === -1) {
                    tempCards.push(cards[i]);
                }
            }
            cards = tempCards;
        }
        while (dealerTotal <= 16 && dealerTotal < playerTotal) {
            console.log("DEALER HITS - dealer total: " + dealerTotal + " - playerTotal: " + playerTotal);
            addcard()
        }
        console.log("DEAlER STAYS - dealer total: " + dealerTotal + " - playerTotal: " + playerTotal);
        if (dealerTotal <= 21 && dealerTotal > playerTotal) {
            showAlert("DEALER WON!", "alert-danger");
        }

        if (dealerTotal <= 21 && dealerTotal < playerTotal) {
            showAlert("YOU WON!", "alert-success");
        }
        if (dealerTotal <= 21 && dealerTotal < playerTotal && playerTotal <= 21) {
            showAlert("YOU WON!", "alert-success");
        }
        if (dealerTotal <= 21 && dealerTotal === playerTotal) {
            showAlert("PUSH!", "alert-info");
        }
        let aces = [];
        if (dealerTotal > 21) {
            for (let i = 0; i < dealerCards.length; i++) {
                if (dealerCards[i].title.indexOf("ace-") !== -1) {
                    aces.push(dealerCards[i].title);
                }
            }
            if (playerTotal > 21) {
                if (aces.length > 0) {
                    dealerTotal = (dealerTotal - (10 * aces.length));
                    console.log("How many Aces? " + aces.length);
                }
                document.getElementById("dealerTotal").innerHTML = dealerTotal;
                if (dealerTotal > 21) {
                    document.getElementById("dealerTotal").innerHTML = dealerTotal;
                    showAlert("YOU BUSTED. DEALER WON!", "alert-danger");
                    setTimeout(() => {
                        // window.location.reload();
                        deal();

                    }, 2000);
                }
            }
            showAlert("DEALER BUSTED. YOU WON!", "alert-success");
        }
    }
</script>

</html>